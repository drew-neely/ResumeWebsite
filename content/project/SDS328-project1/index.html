---
title: "Analysis of Vehicle Fuel Economies"
author: "Drew Neely (dln696)"
date: "2019-10-20T00:00:00Z"
indent: True
output:
  html_document: default
  pdf_document: default
summary: "A statistical analysis of vehicle fuel economy using multuple datasets."
tags:
- Data Science
---



<hr />
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The datasets I chose to analyze for this project are a dataset of vehicle fuel economies in the United States and a dataset of yearly green house gas emission per country.</p>
<p>The dataset of vehicle fuel economies has a row for each make and model of car released in the United States from 1984-2017. The relevant included features for each make and model of car are the year it was released, the type of fuel it uses, the approcximate miles per gallon in the city, on the highway, and combined city and highway driving.</p>
<p>The dataset of green house gas emision per country contains a row for every country and a column for every year 1750-2019. Each entry is the number of tonnes of green house gas emitted from that country in that year.</p>
<p>Both dataset were found on kaggle.com at the following links:</p>
<pre><code>Vehicle Fuel Economy Estimates, 1984-2017 :

  https://www.kaggle.com/epa/fuel-economy/  
  
CO2 and GHG emission data :   

  https://www.kaggle.com/srikantsahu/co2-and-ghg-emission-data/  
  </code></pre>
</div>
<div id="tidying" class="section level1">
<h1>Tidying</h1>
<p>Let us begin by loading the packages and dataframes we will be using. Emissions (called emissions_wide because we’ll later make it long) and cars were both downloaded from kaggle in .csv form.</p>
<pre class="r"><code>library(tidyverse) # Pivot_long doesn&#39;t work without this...?
library(ggplot2)
library(dplyr)
library(ggthemes)


emissions_wide &lt;- read.csv(&quot;emissions.csv&quot;)
cars &lt;- read.csv(&quot;cars.csv&quot;)</code></pre>
<p>emissions_wide is a dataframe with 231 observations (rows) of 268 variables (columns). The first thing we need to do is make the emissions_wide dataframe long. Instead of having a single column for country name and 267 columns for each year of interest, we want it to have a single column for country name, a single column for the year of the observation, and a single column for the observation itself. We will do this with pivot_longer using <code>names_prefix = &quot;X&quot;</code> to remove the “X” from the begining of every year column name, and a mutate to convert the year column from a character type to a numeric type. We will then use filter to remove all observations that are not of the united states, since the fuel economy data only includes US data. We will then remove the Country column since it is no longer neccessary due to it only containing one value.</p>
<pre class="r"><code>emissions &lt;- emissions_wide %&gt;%
  pivot_longer(-Country, names_to = &quot;Year&quot;, names_prefix = &quot;X&quot;, values_to = &quot;Yearly.Emissions&quot;) %&gt;%
  filter(Country == &quot;United States&quot;) %&gt;%
  mutate(Year = as.numeric(Year)) %&gt;%
  select(-Country)

tail(emissions) # prints the end of the dataframe (The begining is very uninteresting)</code></pre>
<pre><code>## # A tibble: 6 x 2
##    Year Yearly.Emissions
##   &lt;dbl&gt;            &lt;dbl&gt;
## 1  2012     372000000000
## 2  2013     378000000000
## 3  2014     383000000000
## 4  2015     389000000000
## 5  2016     394000000000
## 6  2017     399000000000</code></pre>
<p>Next, purely to demonstrate the use of <code>pivot_wider</code> we will put emissions back into wide form.</p>
<pre class="r"><code>emWide &lt;- emissions %&gt;%
  pivot_wider(id_cols = Year, names_from = Year, values_from = Yearly.Emissions) %&gt;%
  select(&quot;2013&quot;, &quot;2014&quot;, &quot;2015&quot;, &quot;2016&quot;, &quot;2017&quot;) # pick only a few columns to make it viewable
head(emWide)</code></pre>
<pre><code>## # A tibble: 1 x 5
##         `2013`       `2014`       `2015`       `2016`       `2017`
##          &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 378000000000 383000000000 389000000000 394000000000 399000000000</code></pre>
<p>Now we will clean up the cars dataset to include only the columns we need instead of all 81 columns in it. We will also rename some of the columns and remove all rows with MPG measurements that are 0 (this data set uses 0 instead of NA).</p>
<pre class="r"><code>carsTidy &lt;- cars %&gt;%
  rename(City.MPG = Unrounded.City.MPG..FT1., Highway.MPG = Unrounded.Highway.MPG..FT1.,
         Combined.MPG = Unrounded.Combined.MPG..FT1.) %&gt;%
  select(Vehicle.ID, Year, Make, Fuel.Type, City.MPG, Highway.MPG, Combined.MPG) %&gt;%
  filter(City.MPG != 0, Highway.MPG != 0, Combined.MPG != 0)</code></pre>
</div>
<div id="joining" class="section level1">
<h1>Joining</h1>
<p>We will now join the datasets on the <code>Year</code> variable using inner join. The purpose of this join is to add a column to the cars dataset that contains the amount of greenhouse gas released by the US the year the car was created. The <code>inner_join</code> method is what we want to use here since it will keep all columns from the first dataset (carsTidy) and add the amount of greenhouse gas emitted to every row based on the year.</p>
<pre class="r"><code>carsEmissions &lt;- carsTidy %&gt;%
  inner_join(emissions, by = c(&quot;Year&quot;, &quot;Year&quot;))</code></pre>
<p>Not all the entries in the emissions dataset are used. This is because the emissions dataset has years ranging from 1750-2019 while the car dataset has years ranging from 1984-2017 (this is from the title of the datasets). However, all of the rows of the carsTidy dataset will be maintained in the resultant dataset. This is not a problem as we only care about the car data and emissions data from the date range over which we have data.</p>
</div>
<div id="wrangling" class="section level1">
<h1>Wrangling</h1>
<p>Let’s first examine the numeric variables we are interested in.</p>
<pre class="r"><code>carsEmissions %&gt;%
  summarise(avgCity = mean(City.MPG),
            sdCity = sd(City.MPG),
            avgHighway = mean(Highway.MPG),
            sdHighway = sd(Highway.MPG),
            avgCombined = mean(Combined.MPG),
            sdCombined = sd(Combined.MPG))</code></pre>
<pre><code>##    avgCity   sdCity avgHighway sdHighway avgCombined sdCombined
## 1 20.77443 11.20033    27.6541  9.710954    23.29061   10.42525</code></pre>
<p>Let’s now create a variable that is an average of the fuel efficiency of the vehicle.</p>
<pre class="r"><code>carsEmissions &lt;- carsEmissions %&gt;%
  mutate(Average.MPG = (City.MPG + Highway.MPG + Combined.MPG) / 3 )

carsEmissions %&gt;%
  select(City.MPG, Highway.MPG, Combined.MPG, Average.MPG) %&gt;%
  summarize_all(mean)</code></pre>
<pre><code>##   City.MPG Highway.MPG Combined.MPG Average.MPG
## 1 20.77443     27.6541     23.29061    23.90638</code></pre>
<p>Let’s next get a basic idea of the data we are looking at begining with the categorical variable Make.</p>
<pre class="r"><code>carsEmissions %&gt;%
  summarise(NumCarEntries=n(),
            NumUniqueMakes=length(unique(Make)))</code></pre>
<pre><code>##   NumCarEntries NumUniqueMakes
## 1          8451             60</code></pre>
<p>There are 8451 entries in carsEmissions and 60 unique entries. Let’s pick just the most common 5 car makes for analyzing.</p>
<pre class="r"><code>summary(carsEmissions$Make, 6)</code></pre>
<pre><code>##           BMW     Chevrolet          Ford Mercedes-Benz        Toyota 
##           701           605           592           517           397 
##       (Other) 
##          5639</code></pre>
<pre class="r"><code>commonMake &lt;- carsEmissions %&gt;%
  filter(Make %in% c(&quot;BMW&quot;, &quot;Chevrolet&quot;, &quot;Ford&quot;, &quot;Mercedes-Benz&quot;, &quot;Toyota&quot;))</code></pre>
<p>We can group by make and Fuel.Type and then summarize with the mean average MPG.</p>
<pre class="r"><code>commonMake %&gt;%
  group_by(Make) %&gt;%
  summarise(mean = mean(Average.MPG),
            count = n(),
            sd = sd(Average.MPG),
            min = min(Average.MPG),
            max = max(Average.MPG)) %&gt;%
  arrange(desc(mean)) %&gt;%
  head()</code></pre>
<pre><code>## # A tibble: 5 x 6
##   Make           mean count    sd   min   max
##   &lt;fct&gt;         &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Toyota         25.0   397  9.90  14.6  76.1
## 2 BMW            23.6   701  9.88  14.4 124. 
## 3 Ford           23.5   592 10.3   11.3 107. 
## 4 Chevrolet      22.8   605 10.0   12.0 119. 
## 5 Mercedes-Benz  21.4   517  6.89  10.8  83.7</code></pre>
<pre class="r"><code>commonMake %&gt;%
  group_by(Make, Fuel.Type) %&gt;%
  summarise(mean = mean(Average.MPG),
            count = n(),
            sd = sd(Average.MPG),
            min = min(Average.MPG),
            max = max(Average.MPG)) %&gt;%
  arrange(desc(mean)) %&gt;%
  head()</code></pre>
<pre><code>## # A tibble: 6 x 7
## # Groups:   Make [5]
##   Make          Fuel.Type                    mean count      sd   min   max
##   &lt;fct&gt;         &lt;fct&gt;                       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 BMW           Electricity                 119.      6 9.14    102.  124. 
## 2 Chevrolet     Electricity                 119.      4 0.0860  119.  119. 
## 3 Ford          Electricity                 105.      6 1.02    105.  107. 
## 4 Mercedes-Benz Electricity                  83.7     4 0.00745  83.7  83.7
## 5 Toyota        Electricity                  76.1     3 0        76.1  76.1
## 6 Toyota        Regular Gas and Electricity  50.6     5 2.04     49.7  54.2</code></pre>
<p>We can see that out of the five companies that created the greatest number of car models, Toyota cars have the best gas milege and Mercedes-Benz have the worst. However, when including the type of fuel a car uses as a grouping variable, we see that the top 5 most fuel efficient vehicles are electric cars (makes sense).</p>
<p>Let’s see which make and class of car has the biggest average difference in city and highway fuel efficiency.</p>
<pre class="r"><code>commonMake %&gt;%
  group_by(Make) %&gt;%
  summarise(diff = mean(abs(City.MPG - Highway.MPG)),
            count = n(),
            sdDiff = sd(abs(City.MPG - Highway.MPG))) %&gt;%
  arrange(desc(diff)) %&gt;%
  head()</code></pre>
<pre><code>## # A tibble: 5 x 4
##   Make           diff count sdDiff
##   &lt;fct&gt;         &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
## 1 BMW            8.48   701   2.33
## 2 Chevrolet      7.41   605   2.50
## 3 Ford           7.09   592   2.28
## 4 Mercedes-Benz  7.04   517   1.91
## 5 Toyota         5.24   397   2.00</code></pre>
<pre class="r"><code>commonMake %&gt;%
  group_by(Make, Fuel.Type) %&gt;%
  summarise(diff = mean(abs(City.MPG - Highway.MPG)),
            count = n(),
            sdDiff = sd(abs(City.MPG - Highway.MPG))) %&gt;%
  arrange(desc(diff)) %&gt;%
  head()</code></pre>
<pre><code>## # A tibble: 6 x 5
## # Groups:   Make [3]
##   Make      Fuel.Type    diff count sdDiff
##   &lt;fct&gt;     &lt;fct&gt;       &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
## 1 BMW       Electricity 22.9      6  6.31 
## 2 Chevrolet Electricity 18.6      4  0.820
## 3 Ford      Electricity 13.0      6  4.73 
## 4 Chevrolet Diesel      11.4      6  4.58 
## 5 BMW       Diesel       9.61    29  2.16 
## 6 BMW       Premium      8.41   653  1.64</code></pre>
<p>BMW cars, and more specifically BMW electric cars have the biggest difference in fuel efficiency from higway to city driving.</p>
<pre class="r"><code>cor(carsEmissions$Average.MPG, carsEmissions$Yearly.Emissions)</code></pre>
<pre><code>## [1] 0.1348772</code></pre>
<p>The Average.MPG variable and the Yearly.Emissions variable are very weakly linearly positively correlated.</p>
<pre class="r"><code>cor(carsEmissions$Year, carsEmissions$Average.MPG)</code></pre>
<pre><code>## [1] 0.1343623</code></pre>
<p>The Year and Average.MPG variable are also weakly linearly correlated.</p>
<pre class="r"><code>cor(carsEmissions$Year, carsEmissions$Yearly.Emissions)</code></pre>
<pre><code>## [1] 0.999662</code></pre>
<p>There is a very strong correlation between Year and Yearly.Emissions.</p>
<pre class="r"><code>carsEmissions %&gt;%
  select(City.MPG, Highway.MPG, Combined.MPG, Average.MPG, Year, Yearly.Emissions) %&gt;%
  cor()</code></pre>
<pre><code>##                   City.MPG Highway.MPG Combined.MPG Average.MPG      Year
## City.MPG         1.0000000   0.9593124    0.9942326   0.9923557 0.1203128
## Highway.MPG      0.9593124   1.0000000    0.9833193   0.9867523 0.1495610
## Combined.MPG     0.9942326   0.9833193    1.0000000   0.9997035 0.1324977
## Average.MPG      0.9923557   0.9867523    0.9997035   1.0000000 0.1343623
## Year             0.1203128   0.1495610    0.1324977   0.1343623 1.0000000
## Yearly.Emissions 0.1207456   0.1501808    0.1329924   0.1348772 0.9996620
##                  Yearly.Emissions
## City.MPG                0.1207456
## Highway.MPG             0.1501808
## Combined.MPG            0.1329924
## Average.MPG             0.1348772
## Year                    0.9996620
## Yearly.Emissions        1.0000000</code></pre>
<p>We can see from all of the summary statistics above that there are a lot of different Makes of car and that the fuel efficiency varaies between different Makes of car a little, and between different fuel types a lot. The only interesting correlation between two numerics is the strong positive correlation between Year and Yearly.Emmissions; Emissions increase over time. I was expecting a higher correlation between year and the three different MPG observations.</p>
</div>
<div id="visualizing" class="section level1">
<h1>Visualizing</h1>
<pre class="r"><code>carsEmissions &lt;- carsEmissions %&gt;% 
  mutate(Common.Fuel.Type = 
          ifelse(Fuel.Type == &quot;Regular&quot;, &quot;Regular&quot;, 
          ifelse(Fuel.Type == &quot;Premium&quot;, &quot;Premium&quot;,
          ifelse(Fuel.Type == &quot;Gasoline or E85&quot;, &quot;Gasoline or E85&quot;,
          ifelse(Fuel.Type == &quot;Electricity&quot;, &quot;Electricity&quot;,
                 &quot;Other&quot; )))))

ggplot(carsEmissions, aes(x = Year, y = Average.MPG, color = Common.Fuel.Type)) +
  ylab(&quot;Average MPG&quot;) +
  xlab(&quot;Year&quot;) +
  geom_point() +
  geom_jitter(width = 0.2) +
  labs(title = &quot;Average Miles Per Gallon by Fuel Type&quot;, color = &quot;Fuel Type&quot;) + 
  geom_smooth(method = &quot;lm&quot;, fill = NA) +
  theme_stata() +
  theme(plot.title = element_text(color = &quot;darkblue&quot;))</code></pre>
<p><img src="/project/SDS328-project1/index_files/figure-html/unnamed-chunk-19-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>This graph shows the change in the Average MPG of cars grouped by the type of fuel that they consume. There are many fuel types in the dataset, so only the most common four are labeled with their own names. The others are grouped into an other category. We can see from the best fit lines for each group that the fuel efficiency increased on average over the years for every fuel type. We can also see that electric cars are the only fuel type for which the average miles per gallon is distinguishable from the other groups and that it is much higher than the other groups.</p>
<pre class="r"><code>carsEmissions &lt;- carsEmissions %&gt;% 
  mutate(Common.Make = 
          ifelse(Make == &quot;BMW&quot;, &quot;BMW&quot;, 
          ifelse(Make == &quot;Chevrolet&quot;, &quot;Chevrolet&quot;,
          ifelse(Make == &quot;Ford&quot;, &quot;Ford&quot;,
          ifelse(Make == &quot;Mercedes-Benz&quot;, &quot;Mercedes-Benz&quot;,
                 &quot;Other&quot; )))))

carsEmissions_long &lt;- carsEmissions %&gt;%
  select(Common.Make, City.MPG, Highway.MPG, Combined.MPG) %&gt;%
  pivot_longer(-Common.Make, names_to = &quot;Measurement&quot;, values_to = &quot;Value&quot;, names_pattern = &quot;(.*).MPG&quot;)

ggplot(carsEmissions_long, aes(x=Common.Make)) +
  xlab(&quot;Make of Vehicle&quot;) +
  ylab(&quot;MPG&quot;) +
  labs(title = &quot;Fuel Efficiency of Vehicles by Make&quot;, color = &quot;Measurement Type&quot;) + 
  geom_point(aes(y=Value, color = Measurement),stat=&quot;summary&quot;, size = 4) +
  scale_y_continuous(breaks = seq(from=14, to=30, by=2)) +
  theme_clean() +
  theme(plot.title = element_text(colour = &quot;gray8&quot;))</code></pre>
<p><img src="/project/SDS328-project1/index_files/figure-html/unnamed-chunk-20-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>This graph shows three different measures of fuel efficiency for each Make of vehicle. It was created by using <code>pivot_long</code> on the <code>carsEmissions</code> dataset to make a categorical variable for the type of the measurement of fuel efficiency. Only the four most common makes in the dataset were included with the rest being grouped into an “Other” group. We can see that Mercedez-Benz has the worst fuel efficiency for all three measurements, and BMW has the best highway performance while Ford has the best city performance (out of only the four most common Makes).</p>
</div>
<div id="dimensionality-reduction" class="section level1">
<h1>Dimensionality Reduction</h1>
<pre class="r"><code>comps &lt;- carsEmissions %&gt;%
  select(Year, City.MPG, Highway.MPG, Combined.MPG, Average.MPG, Yearly.Emissions) %&gt;%
  prcomp()

summary(comps)</code></pre>
<pre><code>## Importance of components:
##                              PC1   PC2   PC3    PC4     PC5       PC6
## Standard deviation     1.087e+10 20.59 2.087 0.1999 0.05232 1.061e-10
## Proportion of Variance 1.000e+00  0.00 0.000 0.0000 0.00000 0.000e+00
## Cumulative Proportion  1.000e+00  1.00 1.000 1.0000 1.00000 1.000e+00</code></pre>
<pre class="r"><code>compsdf &lt;- as.data.frame(comps$x)
compsdf$Common.Fuel.Type = carsEmissions$Common.Fuel.Type
ggplot(compsdf, aes(x = PC2, y = PC3, color=Common.Fuel.Type)) +
  labs(title = &quot;PCA Plot Clustered by Fuel Type&quot;, color = &quot;Fuel Type&quot;) +
  geom_point()</code></pre>
<p><img src="/project/SDS328-project1/index_files/figure-html/unnamed-chunk-22-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>rot &lt;- as.data.frame(comps$rotation)
rot$feature &lt;- row.names(rot)

ggplot(rot, aes(x = PC2, y = PC3, label = feature, color = feature)) +
  geom_point(size = 3) +
  labs(title = &quot;Loadings Plot of Numeric Variables&quot;, color = &quot;Variable&quot;) +
  xlim(-1,1) +
  ylim(-1,1)</code></pre>
<p><img src="/project/SDS328-project1/index_files/figure-html/unnamed-chunk-23-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The most correlated variables are Combined.MPG and Average.MPG (this makes sense since the combined mpg can be expected to be about the average of Highway and City MPGs). Yearly Emissions is not correlated with the MPG. City.MPG and Highway.MPG show almost no correlation.</p>
</div>
